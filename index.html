<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Accounting App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { 
      font-family: 'Segoe UI', sans-serif; 
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .input-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    input, select, button {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
      gap: 10px;
    }
    .tab {
      padding: 10px 20px;
      background-color: #e9ecef;
      border-radius: 6px;
      cursor: pointer;
    }
    .tab.active {
      background-color: #007bff;
      color: white;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #dee2e6;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #f8f9fa;
    }
    .chart-container {
    margin-top: 30px;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    height: 450px !important;
    position: relative;
    }
    .reminder-item {
      padding: 10px;
      margin: 5px 0;
      background-color: #fff3cd;
      border-radius: 4px;
    }
    .due-soon {
      background-color: #f8d7da;
    }
    .bill-alert {
      background-color: #ff4444;
      color: white;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    .auth-container {
      max-width: 400px;
      margin: 100px auto;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .auth-form input {
      width: 100%;
      margin-bottom: 10px;
    }

    .auth-form button {
      width: 100%;
      margin-top: 10px;
    }

    .user-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .logout-btn {
      padding: 8px 16px;
      background-color: #dc3545;
    }

    .logout-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
  <div id="authContainer" class="auth-container">
    <div id="loginForm" class="auth-form">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <button onclick="login()">Login</button>
      <p>Don't have an account? <a href="#" onclick="toggleAuth('signup')">Sign up</a></p>
    </div>

    <div id="signupForm" class="auth-form" style="display:none;">
      <h2>Sign Up</h2>
      <input type="email" id="signupEmail" placeholder="Email" />
      <input type="password" id="signupPassword" placeholder="Password" />
      <input type="password" id="confirmPassword" placeholder="Confirm Password" />
      <button onclick="signup()">Sign Up</button>
      <p>Already have an account? <a href="#" onclick="toggleAuth('login')">Login</a></p>
    </div>
  </div>

  <div id="mainContainer" class="container" style="display:none;">
    <h1>Financial Management Dashboard</h1>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('transactions')">Transactions</div>
      <div class="tab" onclick="switchTab('savings')">Savings</div>
      <div class="tab" onclick="switchTab('reminders')">Bill Reminders</div>
      <div class="tab" onclick="switchTab('analytics')">Analytics</div>
    </div>

    <div id="transactions" class="tab-content">
      <div class="input-group">
        <input id="date" type="date" />
        <input id="desc" type="text" placeholder="Description" />
        <input id="amount" type="number" placeholder="Amount" />
        <select id="type">
          <option value="received">Received</option>
          <option value="spent">Spent</option>
          <option value="saved">Saved</option>
        </select>
        <button onclick="addTransaction()">Add Transaction</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="transactionBody"></tbody>
      </table>
    </div>

    <div id="reminders" class="tab-content" style="display:none;">
      <div class="input-group">
        <input id="billName" type="text" placeholder="Bill Name" />
        <input id="billAmount" type="number" placeholder="Amount" />
        <input id="dueDate" type="date" />
        <button onclick="addBillReminder()">Add Reminder</button>
      </div>
      <div id="remindersList"></div>
    </div>

    <div id="analytics" class="tab-content" style="display:none;">
      <div class="input-group">
        <select id="monthSelector" onchange="updateChart()">
          <!-- Will be populated with months -->
        </select>
      </div>
      <div class="chart-container">
        <canvas id="financialChart"></canvas>
      </div>
    </div>

    <h3 id="summary"></h3>
  </div>

  <script>
    /* filepath: /C:/Users/Thinkpad/Documents/fyp dawlance cv/ytML/ahsan.html */
    let currentUser = null;

    function toggleAuth(type) {
        document.getElementById('loginForm').style.display = type === 'login' ? 'block' : 'none';
        document.getElementById('signupForm').style.display = type === 'signup' ? 'block' : 'none';
    }

    function login() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        
        if (users[email] && users[email].password === password) {
            currentUser = email;
            localStorage.setItem('currentUser', email);
            loadUserData();
            showMainContainer();
        } else {
            alert('Invalid email or password');
        }
    }

    function signup() {
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPass = document.getElementById('confirmPassword').value;
        
        if (password !== confirmPass) {
            alert('Passwords do not match');
            return;
        }
        
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        
        if (users[email]) {
            alert('User already exists');
            return;
        }
        
        users[email] = {
            password: password,
            transactions: [],
            billReminders: []
        };
        
        localStorage.setItem('users', JSON.stringify(users));
        alert('Account created successfully! Please login.');
        toggleAuth('login');
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        transactions = [];
        billReminders = [];
        document.getElementById('authContainer').style.display = 'block';
        document.getElementById('mainContainer').style.display = 'none';
    }

    function showMainContainer() {
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';
        // Add user info and logout button
        const userInfo = document.createElement('div');
        userInfo.className = 'user-info';
        userInfo.innerHTML = `
            <span>Logged in as: ${currentUser}</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        `;
        document.getElementById('mainContainer').insertBefore(userInfo, document.getElementById('mainContainer').firstChild);
    }

    function loadUserData() {
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        if (users[currentUser]) {
            transactions = users[currentUser].transactions || [];
            billReminders = users[currentUser].billReminders || [];
            renderTransactions();
            renderBillReminders();
            updateChart();
        }
    }

    // Add these functions at the start of your script section
    function saveToLocalStorage() {
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        if (currentUser && users[currentUser]) {
            users[currentUser].transactions = transactions;
            users[currentUser].billReminders = billReminders;
            localStorage.setItem('users', JSON.stringify(users));
        }
    }

    function loadFromLocalStorage() {
        const savedTransactions = localStorage.getItem('transactions');
        const savedReminders = localStorage.getItem('billReminders');
        
        if (savedTransactions) {
            transactions = JSON.parse(savedTransactions);
        }
        if (savedReminders) {
            billReminders = JSON.parse(savedReminders);
        }
    }

    let transactions = [];
    let billReminders = [];
    let chartInstance = null;  // Add this line at the top of your script with other variables

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
      document.getElementById(tabName).style.display = 'block';
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      if(tabName === 'analytics') {
        populateMonthSelector();
        updateChart();
      }
    }

    // Modify the addTransaction function
    function addTransaction() {
      const date = document.getElementById('date').value;
      const desc = document.getElementById('desc').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const type = document.getElementById('type').value;

      if (!date || !desc || isNaN(amount)) {
        alert('Please fill all fields correctly.');
        return;
      }

      const transaction = { date, desc, amount, type };
      transactions.push(transaction);
      saveToLocalStorage();
      renderTransactions();
      updateChart();
    }

    // Modify the addBillReminder function
    function addBillReminder() {
      const name = document.getElementById('billName').value;
      const amount = parseFloat(document.getElementById('billAmount').value);
      const dueDate = document.getElementById('dueDate').value;

      if (!name || isNaN(amount) || !dueDate) {
        alert('Please fill all fields correctly.');
        return;
      }

      billReminders.push({ name, amount, dueDate });
      saveToLocalStorage();
      renderBillReminders();
    }

    function renderTransactions() {
      const tbody = document.getElementById('transactionBody');
      tbody.innerHTML = '';

      let received = 0;
      let spent = 0;
      let saved = 0;

      transactions.forEach((t, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${t.date}</td>
          <td>${t.desc}</td>
          <td>Rs ${t.amount.toFixed(2)}</td>
          <td>${t.type}</td>
          <td><button onclick="deleteTransaction(${index})">Delete</button></td>
        `;
        tbody.appendChild(row);

        if (t.type === 'received') received += t.amount;
        else if (t.type === 'spent') spent += t.amount;
        else if (t.type === 'saved') saved += t.amount;
      });

      document.getElementById('summary').innerHTML = `
        Total Received: Rs ${received.toFixed(2)} | 
        Total Spent: Rs ${spent.toFixed(2)} | 
        Total Saved: Rs ${saved.toFixed(2)} | 
        Balance: Rs ${(received - spent - saved).toFixed(2)}
      `;
    }

    /* filepath: /C:/Users/Thinkpad/Documents/fyp dawlance cv/ytML/ahsan.html */
    function renderBillReminders() {
        const container = document.getElementById('remindersList');
        container.innerHTML = '';
        
        // Check for urgent bills and show alerts
        const alertContainer = document.createElement('div');
        alertContainer.id = 'billAlerts';
        container.appendChild(alertContainer);
        
        billReminders.forEach((bill, index) => {
            const daysUntilDue = Math.ceil((new Date(bill.dueDate) - new Date()) / (1000 * 60 * 60 * 24));
            const reminderDiv = document.createElement('div');
            reminderDiv.className = `reminder-item ${daysUntilDue <= 3 ? 'due-soon' : ''}`;
            reminderDiv.innerHTML = `
                ${bill.name} - Rs ${bill.amount.toFixed(2)}
                <br>Due: ${bill.dueDate} (${daysUntilDue} days left)
                <button onclick="markBillPaid(${index})">Mark as Paid</button>
                <button onclick="deleteBillReminder(${index})">Delete</button>
            `;
            container.appendChild(reminderDiv);
            
            // Add urgent bill alerts to main dashboard
            if (daysUntilDue <= 7) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'bill-alert';
                alertDiv.innerHTML = `
                    BILL DUE SOON: ${bill.name} - Rs ${bill.amount.toFixed(2)}
                    (Due in ${daysUntilDue} days)
                `;
                document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.tabs'));
            }
        });
    }

    // Modify the markBillPaid function
    function markBillPaid(index) {
        billReminders.splice(index, 1);
        saveToLocalStorage();
        renderBillReminders();
        // Remove any alerts when bill is paid
        document.querySelectorAll('.bill-alert').forEach(alert => alert.remove());
    }

    /* filepath: /C:/Users/Thinkpad/Documents/fyp dawlance cv/ytML/ahsan.html */
    function updateChart() {
    const ctx = document.getElementById('financialChart').getContext('2d');
    
    if (chartInstance) {
        chartInstance.destroy();
    }
    
    // Get selected month and year
    const [selectedYear, selectedMonth] = document.getElementById('monthSelector').value.split('-');
    
    // Get first and last day of selected month
    const firstDay = new Date(selectedYear, selectedMonth - 1, 1);
    const lastDay = new Date(selectedYear, selectedMonth, 0);
    
    // Create array of all dates in month
    const allDates = [];
    const dailyTotals = {};
    
    // Initialize all dates of the month with zero values
    for(let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 1)) {
        const dateStr = d.toISOString().split('T')[0];
        allDates.push(dateStr);
        dailyTotals[dateStr] = { received: 0, spent: 0, saved: 0 };
    }
    
    // Accumulate transactions by date
    transactions.forEach(t => {
        const transactionDate = t.date;
        if (transactionDate >= firstDay.toISOString().split('T')[0] && 
            transactionDate <= lastDay.toISOString().split('T')[0]) {
            dailyTotals[transactionDate][t.type] += t.amount;
        }
    });

    // Create cumulative totals
    let cumulativeReceived = 0;
    let cumulativeSpent = 0;
    let cumulativeSaved = 0;
    
    const cumulativeData = allDates.map(date => {
        cumulativeReceived += dailyTotals[date].received;
        cumulativeSpent += dailyTotals[date].spent;
        cumulativeSaved += dailyTotals[date].saved;
        return {
            received: cumulativeReceived,
            spent: cumulativeSpent,
            saved: cumulativeSaved
        };
    });

    chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: allDates,
            datasets: [{
                label: 'Total Received',
                data: cumulativeData.map(d => d.received),
                borderColor: 'green',
                tension: 0.4,
                fill: false
            }, {
                label: 'Total Spent',
                data: cumulativeData.map(d => d.spent),
                borderColor: 'red',
                tension: 0.4,
                fill: false
            }, {
                label: 'Total Saved',
                data: cumulativeData.map(d => d.saved),
                borderColor: 'blue',
                tension: 0.4,
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: Rs ${context.raw.toFixed(2)}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawBorder: false
                    },
                    ticks: {
                        callback: function(value) {
                            return 'Rs ' + value.toFixed(0);
                        }
                    }
                },
                x: {
                    grid: {
                        drawBorder: false
                    },
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45,
                        callback: function(value, index) {
                            // Show fewer x-axis labels for better readability
                            const date = new Date(allDates[index]);
                            return date.getDate(); // Only show day of month
                        }
                    }
                }
            }
        }
    });
}

    // Modify the deleteTransaction function
    function deleteTransaction(index) {
      transactions.splice(index, 1);
      saveToLocalStorage();
      renderTransactions();
      updateChart();
    }

    // Modify the deleteBillReminder function
    function deleteBillReminder(index) {
      billReminders.splice(index, 1);
      saveToLocalStorage();
      renderBillReminders();
    }

    // Add these functions before updateChart()

    function populateMonthSelector() {
        const monthSelect = document.getElementById('monthSelector');
        const months = [];
        const currentDate = new Date();
        
        // Get all unique months from transactions
        transactions.forEach(t => {
            const date = new Date(t.date);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (!months.includes(monthYear)) {
                months.push(monthYear);
            }
        });

        // Add current month if not already in list
        const currentMonth = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
        if (!months.includes(currentMonth)) {
            months.push(currentMonth);
        }

        // Sort months in descending order
        months.sort().reverse();

        // Populate selector
        monthSelect.innerHTML = months.map(m => {
            const [year, month] = m.split('-');
            const monthName = new Date(year, month - 1).toLocaleString('default', { month: 'long' });
            return `<option value="${m}">${monthName} ${year}</option>`;
        }).join('');
    }

    // Initialize app
    document.getElementById('date').valueAsDate = new Date();
        /* filepath: /C:/Users/Thinkpad/Documents/fyp dawlance cv/ytML/ahsan.html */
    // Modify the DOMContentLoaded event listener
    document.addEventListener('DOMContentLoaded', function() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            currentUser = savedUser;
            loadUserData();
            showMainContainer();
        }
        document.getElementById('date').valueAsDate = new Date();
        renderBillReminders(); // Show any urgent bills on load
        renderTransactions();
        populateMonthSelector(); // Initialize month selector
    });
  </script>
</body>
</html>